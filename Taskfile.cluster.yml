version: '3'

tasks:

  install-docker-compose:
    status:
      - docker-compose --version
    cmds:
      - python3 -m pip install docker-compose

  assemble: "{{ .CMD_GRADLE }} assemble"

  run:
    dir: elastiknn-testing
    deps:
      - install-docker-compose
      - assemble
      - stop
    cmds:
      - sudo sysctl -w vm.max_map_count=262144
      - docker-compose up --detach --build --force-recreate
      - python3 cluster_ready.py

  minio:run:
    dir: elastiknn-testing
    deps:
      - install-docker-compose
    cmds:
      - docker-compose up -d minio

  logs:
    dir: elastiknn-testing
    cmds:
      - docker-compose logs

  stop:
    dir: elastiknn-testing
    cmds:
      - docker-compose down
