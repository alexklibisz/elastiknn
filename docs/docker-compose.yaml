version: "3.8"

services:

  # Local development server with automatic recompilation.
  dev:
    container_name: elastiknn-docs-dev
    image: ruby:3.1.1
    volumes:
      - ".:/mnt/docs"
      - "./.gemcache:/usr/local/bundle/cache"
    working_dir: '/mnt/docs'
    command:
      - "/bin/bash"
      - "-ec"
      - |
        bundle install
        bundle exec jekyll serve --host 0.0.0.0
    ports:
      - "4000:4000/tcp"

  # Build site for publication. Output is in site/_site.
  compile:
    container_name: elastiknn-docs-build
    image: ruby:3.1.1
    volumes:
      - ".:/mnt/docs"
      - "./.gemcache:/usr/local/bundle/cache"
    working_dir: '/mnt/docs'
    environment:
      - JEKYLL_ENV=production
    command:
      - "/bin/bash"
      - "-ec"
      - |
        bundle install
        bundle exec jekyll build
