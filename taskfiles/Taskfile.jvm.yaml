version: '3'

tasks:

  clean:
    desc: Clean all JVM artifacts
    cmds:
      - find . -name target | xargs rm -rf

  test:
    desc: Run JVM tests using Gradle
    cmds:
      - sbt test

  plugin:publish:snapshot:
    desc: Publish a snapshot release to Github
    cmds:
      - sbt elastiknn-plugin/elasticsearchPluginBundle
      - gh release delete {{ .VERSION }} --yes || true
      - gh release create --prerelease --generate-notes {{ .VERSION }} elastiknn-plugin/target/elastiknn-*.zip

  plugin:publish:release:
    desc: Publish an official release to Github
    status:
      - curl -f -s -o /dev/null {{ .GITHUB_URL }}/releases/tag/{{ .VERSION }}
    cmds:
      - sbt elastiknn-plugin/elasticsearchPluginBundle
      - gh release create --generate-notes {{ .VERSION }} elastiknn-plugin/target/elastiknn-*.zip

  run:
    desc: Run Elasticsearch using SBT
    cmds:
      - sbt elastiknn-plugin/elasticsearchPluginRun

  debug:
    desc: Run Elasticsearch in debug mode using gradle
    cmds:
      - sbt elastiknn-plugin/elasticsearchPluginDebug
