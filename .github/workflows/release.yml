name: Release
on:
  push:
    branches: 
      - master

jobs:

  release:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2
      - name: Setup Release Credentials
        env:
          GPG_SECRET_B64: ${{ secrets.GPG_SECRET_B64 }}
          GRADLE_PROPERTIES_B64: ${{ secrets.GRADLE_PROPERTIES_B64 }}
          PYPIRC_B64: ${{ secrets.PYPIRC_B64 }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          SSH_CONFIG_B64: ${{ secrets.SSH_CONFIG_B64 }}
          SSH_IDRSA_B64: ${{ secrets.SSH_IDRSA_B64 }}
      - run: |
          sudo snap install task --classic
          sudo snap install hub --classic
          python3 -m pip install setuptools
      - name: Publish to PyPi
        run: task py:release
      - name: Publish to Sonatype
        run: task jvm:publish-libraries-release
      - name: Publish to Github
        run: task jvm:publish-plugin-release
